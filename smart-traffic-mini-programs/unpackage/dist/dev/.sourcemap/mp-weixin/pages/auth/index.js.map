{"version":3,"file":"index.js","sources":["pages/auth/index.vue","../../../software/011-HBuilderX/HBuilderX.4.45.2025010502/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvYXV0aC9pbmRleC52dWU"],"sourcesContent":["<template>\r\n  <view class=\"auth-container\">\r\n    <view class=\"logo-container\">\r\n      <image class=\"logo\" src=\"/static/logo.svg\" mode=\"aspectFit\"></image>\r\n      <text class=\"title\">智慧交通</text>\r\n    </view>\r\n\r\n    <wd-tabs v-model=\"activeTab\" style=\"margin-bottom: 20px\">\r\n      <wd-tab title=\"登录\"></wd-tab>\r\n      <wd-tab title=\"注册\"></wd-tab>\r\n    </wd-tabs>\r\n\r\n    <wd-form\r\n      ref=\"formRef\"\r\n      :model=\"formData\"\r\n      :rules=\"rules\"\r\n      :validate-trigger=\"['onBlur']\"\r\n    >\r\n      <wd-cell-group>\r\n        <wd-input\r\n          v-model=\"formData.username\"\r\n          name=\"username\"\r\n          label=\"用户名\"\r\n          placeholder=\"请输入用户名\"\r\n          clearable\r\n          suffix-icon=\"ri-user-line\"\r\n        />\r\n\r\n        <wd-input\r\n          v-model=\"formData.password\"\r\n          name=\"password\"\r\n          label=\"密码\"\r\n          placeholder=\"请输入密码\"\r\n          clearable\r\n          suffix-icon=\"ri-lock-line\"\r\n          show-password\r\n          type=\"password\"\r\n        />\r\n\r\n        <!-- 使用一个固定高度的容器来包裹确认密码输入框 -->\r\n        <view class=\"confirm-password-container\">\r\n          <wd-input\r\n            v-if=\"activeTab === 1\"\r\n            v-model=\"formData.confirmPassword\"\r\n            name=\"confirmPassword\"\r\n            label=\"确认密码\"\r\n            placeholder=\"请再次输入密码\"\r\n            clearable\r\n            suffix-icon=\"ri-lock-line\"\r\n            show-password\r\n            type=\"password\"\r\n          />\r\n        </view>\r\n      </wd-cell-group>\r\n\r\n      <view style=\"margin: 30rpx 0\">\r\n        <wd-button type=\"primary\" block @click=\"handleSubmit\">\r\n          {{ activeTab === 0 ? \"登录\" : \"注册\" }}\r\n        </wd-button>\r\n      </view>\r\n    </wd-form>\r\n\r\n    <view class=\"footer-tips\">\r\n      <text v-if=\"activeTab === 0\">还没有账号？点击上方\"注册\"</text>\r\n      <text v-else>已有账号？点击上方\"登录\"</text>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, reactive } from \"vue\";\r\n\r\n// 表单引用\r\nconst formRef = ref(null);\r\n\r\n// 当前激活的标签页（0: 登录, 1: 注册）\r\nconst activeTab = ref(0);\r\n\r\n// 表单数据\r\nconst formData = reactive({\r\n  username: \"\",\r\n  password: \"\",\r\n  confirmPassword: \"\",\r\n});\r\n\r\n// 表单校验规则\r\nconst rules = reactive({\r\n  username: [\r\n    { required: true, message: \"请输入用户名\", trigger: \"blur\" },\r\n    { min: 3, max: 20, message: \"用户名长度应为3-20个字符\", trigger: \"blur\" },\r\n  ],\r\n  password: [\r\n    { required: true, message: \"请输入密码\", trigger: \"blur\" },\r\n    { min: 6, max: 20, message: \"密码长度应为6-20个字符\", trigger: \"blur\" },\r\n  ],\r\n  confirmPassword: [\r\n    { required: true, message: \"请再次输入密码\", trigger: \"blur\" },\r\n    {\r\n      validator: (rule, value, callback) => {\r\n        if (value !== formData.password) {\r\n          callback(new Error(\"两次输入的密码不一致\"));\r\n        } else {\r\n          callback();\r\n        }\r\n      },\r\n      trigger: \"blur\",\r\n    },\r\n  ],\r\n});\r\n\r\n// 提交表单\r\nconst handleSubmit = () => {\r\n  // 根据当前标签页过滤要验证的字段\r\n  const validateFields =\r\n    activeTab.value === 0\r\n      ? [\"username\", \"password\"]\r\n      : [\"username\", \"password\", \"confirmPassword\"];\r\n  formRef.value\r\n    .validate(validateFields)\r\n    .then((valid) => {\r\n      if (valid) {\r\n        if (activeTab.value === 0) {\r\n          // 登录逻辑\r\n          import('@/api/auth').then(({ login }) => {\r\n            login({\r\n              username: formData.username,\r\n              password: formData.password\r\n            })\r\n            .then(res => {\r\n              // 保存token\r\n              uni.setStorageSync('token', res.token);\r\n              \r\n              uni.showToast({\r\n                title: \"登录成功\",\r\n                icon: \"success\",\r\n              });\r\n              \r\n              // 跳转到主页\r\n              uni.navigateTo({\r\n                url: \"/pages/index/index\",\r\n              });\r\n            })\r\n            .catch(err => {\r\n              uni.showToast({\r\n                title: err.message || \"登录失败\",\r\n                icon: \"none\",\r\n              });\r\n            });\r\n          });\r\n        } else {\r\n          // 注册逻辑\r\n          import('@/api/auth').then(({ register }) => {\r\n            register({\r\n              username: formData.username,\r\n              password: formData.password\r\n            })\r\n            .then(res => {\r\n              // 保存token\r\n              uni.setStorageSync('token', res.token);\r\n              \r\n              uni.showToast({\r\n                title: \"注册成功\",\r\n                icon: \"success\",\r\n              });\r\n              \r\n              // 注册成功后切换到登录页或直接登录\r\n              activeTab.value = 0;\r\n            })\r\n            .catch(err => {\r\n              uni.showToast({\r\n                title: err.message || \"注册失败\",\r\n                icon: \"none\",\r\n              });\r\n            });\r\n          });\r\n        }\r\n      }\r\n    })\r\n    .catch((error) => {\r\n      console.log(\"表单校验失败\", error);\r\n    });\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.auth-container {\r\n  padding: 40rpx;\r\n  display: flex;\r\n  flex-direction: column;\r\n}\r\n\r\n.logo-container {\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n  margin: 30rpx 0 60rpx;\r\n}\r\n\r\n.logo {\r\n  width: 200rpx;\r\n  height: 200rpx;\r\n  margin-bottom: 20rpx;\r\n  border-radius: 20rpx;\r\n  transition: transform 0.3s ease;\r\n}\r\n\r\n.logo:active {\r\n  transform: scale(1.05);\r\n}\r\n\r\n.title {\r\n  font-size: 36rpx;\r\n  font-weight: bold;\r\n  color: #333;\r\n  text-shadow: 0 2rpx 4rpx rgba(0, 0, 0, 0.05);\r\n}\r\n\r\n.footer-tips {\r\n  margin-top: 40rpx;\r\n  text-align: center;\r\n  color: #999;\r\n  font-size: 26rpx;\r\n}\r\n\r\n.confirm-password-container {\r\n  min-height: 90rpx; /* 设置与其他输入框相同的高度 */\r\n}\r\n</style>\r\n","import MiniProgramPage from 'D:/code/smart-traffic/smart-traffic-mini-programs/pages/auth/index.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","reactive","uni"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;AAyEA,UAAM,UAAUA,cAAAA,IAAI,IAAI;AAGxB,UAAM,YAAYA,cAAAA,IAAI,CAAC;AAGvB,UAAM,WAAWC,cAAAA,SAAS;AAAA,MACxB,UAAU;AAAA,MACV,UAAU;AAAA,MACV,iBAAiB;AAAA,IACnB,CAAC;AAGD,UAAM,QAAQA,cAAAA,SAAS;AAAA,MACrB,UAAU;AAAA,QACR,EAAE,UAAU,MAAM,SAAS,UAAU,SAAS,OAAQ;AAAA,QACtD,EAAE,KAAK,GAAG,KAAK,IAAI,SAAS,kBAAkB,SAAS,OAAQ;AAAA,MAChE;AAAA,MACD,UAAU;AAAA,QACR,EAAE,UAAU,MAAM,SAAS,SAAS,SAAS,OAAQ;AAAA,QACrD,EAAE,KAAK,GAAG,KAAK,IAAI,SAAS,iBAAiB,SAAS,OAAQ;AAAA,MAC/D;AAAA,MACD,iBAAiB;AAAA,QACf,EAAE,UAAU,MAAM,SAAS,WAAW,SAAS,OAAQ;AAAA,QACvD;AAAA,UACE,WAAW,CAAC,MAAM,OAAO,aAAa;AACpC,gBAAI,UAAU,SAAS,UAAU;AAC/B,uBAAS,IAAI,MAAM,YAAY,CAAC;AAAA,YAC1C,OAAe;AACL;YACD;AAAA,UACF;AAAA,UACD,SAAS;AAAA,QACV;AAAA,MACF;AAAA,IACH,CAAC;AAGD,UAAM,eAAe,MAAM;AAEzB,YAAM,iBACJ,UAAU,UAAU,IAChB,CAAC,YAAY,UAAU,IACvB,CAAC,YAAY,YAAY,iBAAiB;AAChD,cAAQ,MACL,SAAS,cAAc,EACvB,KAAK,CAAC,UAAU;AACf,YAAI,OAAO;AACT,cAAI,UAAU,UAAU,GAAG;AAEzB,YAAO,oBAAc,KAAK,CAAC,EAAE,MAAK,MAAO;AACvC,oBAAM;AAAA,gBACJ,UAAU,SAAS;AAAA,gBACnB,UAAU,SAAS;AAAA,cACjC,CAAa,EACA,KAAK,SAAO;AAEXC,8BAAAA,MAAI,eAAe,SAAS,IAAI,KAAK;AAErCA,8BAAAA,MAAI,UAAU;AAAA,kBACZ,OAAO;AAAA,kBACP,MAAM;AAAA,gBACtB,CAAe;AAGDA,8BAAAA,MAAI,WAAW;AAAA,kBACb,KAAK;AAAA,gBACrB,CAAe;AAAA,cACf,CAAa,EACA,MAAM,SAAO;AACZA,8BAAAA,MAAI,UAAU;AAAA,kBACZ,OAAO,IAAI,WAAW;AAAA,kBACtB,MAAM;AAAA,gBACtB,CAAe;AAAA,cACf,CAAa;AAAA,YACb,CAAW;AAAA,UACX,OAAe;AAEL,YAAO,oBAAc,KAAK,CAAC,EAAE,SAAQ,MAAO;AAC1C,uBAAS;AAAA,gBACP,UAAU,SAAS;AAAA,gBACnB,UAAU,SAAS;AAAA,cACjC,CAAa,EACA,KAAK,SAAO;AAEXA,8BAAAA,MAAI,eAAe,SAAS,IAAI,KAAK;AAErCA,8BAAAA,MAAI,UAAU;AAAA,kBACZ,OAAO;AAAA,kBACP,MAAM;AAAA,gBACtB,CAAe;AAGD,0BAAU,QAAQ;AAAA,cAChC,CAAa,EACA,MAAM,SAAO;AACZA,8BAAAA,MAAI,UAAU;AAAA,kBACZ,OAAO,IAAI,WAAW;AAAA,kBACtB,MAAM;AAAA,gBACtB,CAAe;AAAA,cACf,CAAa;AAAA,YACb,CAAW;AAAA,UACF;AAAA,QACF;AAAA,MACP,CAAK,EACA,MAAM,CAAC,UAAU;AAChBA,sBAAY,MAAA,MAAA,OAAA,+BAAA,UAAU,KAAK;AAAA,MACjC,CAAK;AAAA,IACL;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACpLA,GAAG,WAAW,eAAe;"}